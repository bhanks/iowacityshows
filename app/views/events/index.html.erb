<meta name="viewport" content="width=device-width, maximum-scale=1.6" />
<script type="text/javascript">
var updateLayout = function() {
  if (window.innerWidth != currentWidth) {
    currentWidth = window.innerWidth;
    var orient = (currentWidth == 320) ? "profile" : "landscape";
    document.body.setAttribute("orient", orient);
    window.scrollTo(0, 1);
  }
};

iPhone.DomLoad(updateLayout);
setInterval(updateLayout, 400);
</script>

<% if @venue %>
	<h1><%= @venue.name %></h1>
<%
	else
%>
	<h1>Events in Iowa City</h1>
<%
		mixed = true
		cur_day = ""
	end 
%>
<div class="events">
	<% altswitch = false %>
	<% @events.each do |event| %>
		<% 
			item = (altswitch)? "'item alt'" : "'item'" 
			altswitch = !altswitch
		%>
		<% if mixed && event_day(event.begins_at) != cur_day %>
			<div class="header"><%= event.begins_at.strftime("%A, %B #{event.begins_at.day.ordinalize}")%></div>
		<% 
				cur_day = event_day(event.begins_at)
			 end 
		%>
		<div class=<%= item %> onclick=<%="window.location='#{event_path(event.id)}'"%>>
			<div class="bullet">
				<ul>
					<li class="bullet day">
						<%= (mixed)? event.venue.display_name : event_day(event.begins_at)%>
					</li>
					<li class='date bullet'>
						<%= (mixed)? "" : event.begins_at.strftime("%b #{event.begins_at.day.ordinalize}") %>
					</li>
					<li class='time bullet'>
						<%= am_pm(event.begins_at) %>
					</li>
				</ul>
			</div>
			<div class='info'>


				<h2 class='event title'><%= event.name %></h2>
				<p class='description'><%= strip_tags event.description %></p>
				<div class="details">
					<ul>
						<li class='event age'><%= event.age_restriction %></li>
						<li class='price'><%= price_render(event.price) %></li>
					</ul>
				</div>
				

			</div>
	
		</div>
	<% end %>

</div>
	
<ul class="navigation">
	<li><%= link_to("This Week", week_events_path()) %></li>
	<li><%= link_to("Venue List", venues_path()) %></li>
</ul>
